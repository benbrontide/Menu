<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>L’Osteria – Online-Bestellung</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    :root {
      --btn-bg: #444;
      --btn-color: #fff;
      --modal-bg: rgba(0,0,0,.8);
      --font-base: 1rem;
      --btn-padding-vert: .6rem;
      --btn-padding-horiz: 1rem;
      --chip-font: .9rem;
      --chip-padding-vert: .4rem;
      --chip-padding-horiz: .8rem;
    }
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 1rem;
      background: #f8f8f8;
      font-size: var(--font-base);
      color: #222;
    }
    h1 {
      font-size: 1.8rem;
      margin-bottom: 1rem;
    }
    button {
      cursor: pointer;
      border: none;
      padding: var(--btn-padding-vert) var(--btn-padding-horiz);
      border-radius: 8px;
      font-size: 1rem;
      background: var(--btn-bg);
      color: var(--btn-color);
      transition: background .2s;
    }
    button:hover {
      background: #666;
    }
    .person-chip {
      display: inline-block;
      padding: var(--chip-padding-vert) var(--chip-padding-horiz);
      border-radius: 16px;
      color: #fff;
      font-weight: 600;
      margin: .3rem;
      font-size: var(--chip-font);
    }
    #personList {
      display: flex;
      flex-wrap: wrap;
      gap: .6rem;
      margin-bottom: .8rem;
    }
    .person-btn {
      flex: 1 1 calc(50% - .6rem);
      padding: .5rem .8rem;
      font-size: .95rem;
      text-align: center;
      border-radius: 8px;
    }
    .menu-item {
      background: #fff;
      padding: 1.2rem;
      margin: .6rem 0;
      border-radius: 10px;
      box-shadow: 0 1px 4px rgba(0,0,0,.1);
      display: flex;
      flex-direction: column;
      gap: .6rem;
    }
    .menu-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }
    .menu-text {
      flex: 1 1 auto;
      min-width: 200px;
      font-size: 1rem;
    }
    .price {
      font-weight: 700;
      margin-left: .6rem;
      font-size: 1rem;
    }
    .assigned {
      display: flex;
      flex-wrap: wrap;
      gap: .3rem;
      margin-top: .6rem;
    }
    .modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      display: none;
      align-items: center;
      justify-content: center;
      background: var(--modal-bg);
      z-index: 10;
    }
    .modal.active {
      display: flex;
    }
    .modal-content {
      background: #fff;
      padding: 1.2rem;
      border-radius: 10px;
      max-height: 80vh;
      overflow-y: auto;
      width: 90%;
      max-width: 400px;
    }
    .assign-person {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: .5rem .9rem;
      border-radius: 10px;
      margin: .3rem;
      min-width: 90px;
      font-weight: 600;
      color: #fff;
      opacity: .5;
      border: 2px solid transparent;
      cursor: pointer;
      font-size: .9rem;
    }
    .assign-person.selected {
      opacity: 1;
      border-color: #000;
    }
    .assign-person .qty {
      position: absolute;
      bottom: -8px; right: -8px;
      background: #000;
      color: #fff;
      border-radius: 50%;
      font-size: .75rem;
      width: 24px; height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #actionBar {
      display: none;
      margin-top: 1rem;
      gap: .8rem;
      flex-wrap: wrap;
    }
  </style>
</head>
<body>
  <h1>L’Osteria – Essen bestellen / Place your Order</h1>
  <div id="selectedPersons"></div>
  <button id="choosePersonBtn">Choose a person / Person auswählen</button>
  <button id="chooseFoodBtn" style="display:none; margin-left: .5rem;">
    Choose your food / Essen auswählen
  </button>
  <div id="menuContainer" style="display:none; margin-top:1rem;"></div>
  <div id="actionBar">
    <button id="finishBtn" style="background:#008000;">Finished – WhatsApp / Fertig – WhatsApp</button>
    <button id="copyBtn" style="background:#555;">Copy text / Text kopieren</button>
  </div>

  <!-- Person selection modal -->
  <div id="personModal" class="modal">
    <div class="modal-content">
      <h3>Wähle Personen / Choose people</h3>
      <div id="personList"></div>
      <button onclick="closePersonModal()">OK</button>
    </div>
  </div>

  <!-- Assignment modal -->
  <div id="assignModal" class="modal">
    <div class="modal-content">
      <h3 id="assignTitle"></h3>
      <div id="assignList" style="display:flex; flex-wrap:wrap;"></div>
      <button onclick="confirmAssignment()">OK</button>
    </div>
  </div>

  <script>
    const people = ["Christa","Jochen","Sabine","Sven","Tom","Jan","Lena",
                    "Ben","Jojo","Hanna","Alex","Belle","Ellen","Vikas","Lisa","Mira"];

    const menu = [
      { de:"Margherita (Tomatensauce, Mozzarella, Basilikum)", en:"Margherita (Tomato sauce, mozzarella, basil)", price:"" },
      { de:"Prosciutto (Schinkenschulter, Käse)", en:"Prosciutto (Shoulder of ham, cheese)", price:"" },
      { de:"Salami (Salami, Käse)", en:"Salami (Salami, cheese)", price:"" },
      { de:"Funghi Freschi (frische Champignons, Käse)", en:"Funghi Freschi (Fresh mushrooms, cheese)", price:"" },
      { de:"Prosciutto e Funghi (Schinkenschulter, frische Champignons, Käse)", en:"Prosciutto e Funghi (Shoulder of ham, fresh mushrooms, cheese)", price:"" },
      { de:"Pizza Bò (Calzone) (gefüllt mit Schinken, Champignons, Salami, Käse)", en:"Pizza Bò (Calzone) (filled with ham, mushrooms, salami, cheese)", price:"" },
      { de:"Braccio di Ferro (Spinat, Ei, Käse, Knoblauch)", en:"Braccio di Ferro (Spinach, egg, cheese, garlic)", price:"" },
      { de:"Hawaii (Schinkenschulter, Ananas, Käse)", en:"Hawaii (Shoulder of ham, pineapple, cheese)", price:"" },
      { de:"Canario (Schinkenschulter, Champignons, Salami, Anchovis, Käse)", en:"Canario (Shoulder of ham, mushrooms, salami, anchovies, cheese)", price:"" },
      { de:"Cip & Ciop (Mozzarella, Kapern, Anchovis, Oregano)", en:"Cip & Ciop (Mozzarella, capers, anchovies, oregano)", price:"" },
      { de:"Tonno (Thunfisch, Zwiebeln, Käse)", en:"Tonno (Tuna, onions, cheese)", price:"" },
      { de:"Gamberetti (Pizza Bianca) (Garnelen, frische Tomaten, Käse, Knoblauch)", en:"Gamberetti (Pizza Bianca) (Shrimps, fresh tomatoes, cheese, garlic)", price:"" },
      { de:"Marinara (Meeresfrüchte, Käse, Knoblauch)", en:"Marinara (Seafood, cheese, garlic)", price:"" },
      { de:"Salsiccia Piccante (Mozzarella, scharfe Peperoni-Salami, Basilikum)", en:"Salsiccia Piccante (Mozzarella, spicy pepperoni-salami, basil)", price:"" },
      { de:"BBQ Chicken (Mozzarella, BBQ-Sauce, knusprige Hähnchenbrust, Paprika, Zwiebeln)", en:"BBQ Chicken (Mozzarella, BBQ sauce, fried chicken breast strips, peppers, onions)", price:"" },
      { de:"Salsiccia Fresca (Mozzarella, italienische Fenchelsalami, Wirsing, Grana Padano DOP)", en:"Salsiccia Fresca (Mozzarella, Italian fennel sausage, savoy cabbage, Grana Padano DOP)", price:"" },
      { de:"Rustica (Mozzarella, frische Tomaten, Oliven, Zwiebeln, Oregano, scharf)", en:"Rustica (Mozzarella, fresh tomatoes, olives, onions, oregano, spicy)", price:"" },
      { de:"Parmigiana (Mozzarella, Aubergine, Grana Padano DOP, Oregano)", en:"Parmigiana (Mozzarella, aubergine, Grana Padano DOP, oregano)", price:"" },
      { de:"Prosciutto Crudo (Mozzarella, luftgetrockneter Rohschinken)", en:"Prosciutto Crudo (Mozzarella, air-dried ham)", price:"" },
      { de:"Caprese (italienische Mozzarella-Kugel, Kirschtomaten, Basilikum)", en:"Caprese (Italian mozzarella ball, cherry tomatoes, basil)", price:"" },
      { de:"Vegetariana (Mozzarella, gegrilltes Gemüse, Champignons, Knoblauch, Rucola)", en:"Vegetariana (Mozzarella, grilled vegetables, mushrooms, garlic, rocket)", price:"" },
      { de:"Quattro Formaggi (Mozzarella, Edamer, Gorgonzola, Grana Padano DOP)", en:"Quattro Formaggi (Mozzarella, Edam, Gorgonzola, Grana Padano DOP)", price:"" },
      { de:"Rucola (Mozzarella, Rucola, Grana Padano DOP, Knoblauch)", en:"Rucola (Mozzarella, rocket, Grana Padano DOP, garlic)", price:"" }
    ];

    let selected = {}, orders = {};

    function rndHue(i){ return `hsl(${(i*137.508)%360},70%,50%)`; }
    function renderSelected(){
      const w = document.getElementById("selectedPersons");
      w.innerHTML = "";
      Object.entries(selected).forEach(([n,c])=>{
        const chip = document.createElement("span");
        chip.className="person-chip";
        chip.textContent = n;
        chip.style.background = c;
        w.appendChild(chip);
      });
      document.getElementById("chooseFoodBtn").style.display =
        Object.keys(selected).length ? "" : "none";
    }
    function openPersonModal(){ document.getElementById("personModal").classList.add("active"); }
    function closePersonModal(){ document.getElementById("personModal").classList.remove("active"); renderSelected(); }
    document.getElementById("choosePersonBtn").onclick = openPersonModal;

    const pl = document.getElementById("personList");
    people.forEach((p,i)=>{
      const b = document.createElement("button");
      b.className="person-btn"; b.textContent = p;
      b.onclick = ()=>{
        if(selected[p]){
          delete selected[p];
          b.classList.remove("selected");
          b.style.background = "";
          b.style.color = "";
        } else {
          selected[p] = rndHue(Object.keys(selected).length);
          b.classList.add("selected");
          b.style.background = selected[p];
          b.style.color = "#fff";
        }
      };
      pl.appendChild(b);
    });

    function showMenu(){
      const c = document.getElementById("menuContainer");
      c.innerHTML = "";
      menu.forEach((it,idx)=>{
        const item = document.createElement("div");
        item.className="menu-item"; item.dataset.idx = idx;
        const hdr = document.createElement("div");
        hdr.className="menu-header";
        hdr.innerHTML = `
          <div class="menu-text">
            <strong>${it.de}</strong><br><em>${it.en}</em>
            <span class="price">${it.price}</span>
          </div>`;
        const btn = document.createElement("button");
        btn.textContent="Select / Auswählen";
        btn.onclick = ()=> openAssign(idx);
        hdr.appendChild(btn);
        item.appendChild(hdr);
        const ass = document.createElement("div");
        ass.className="assigned"; ass.id = `a${idx}`;
        item.appendChild(ass);
        c.appendChild(item);
      });
      c.style.display=""; document.getElementById("actionBar").style.display="flex";
    }
    document.getElementById("chooseFoodBtn").onclick = showMenu;

    let currentIdx = 0;
    function openAssign(idx){
      currentIdx = idx;
      document.getElementById("assignTitle").textContent = menu[idx].de;
      const al = document.getElementById("assignList");
      al.innerHTML = "";
      Object.entries(selected).forEach(([n,c])=>{
        let qty = (orders[n]||{})[idx]||0;
        const div = document.createElement("div");
        div.className="assign-person"; div.style.background = c;
        if(qty) div.classList.add("selected");
        div.innerHTML = n + (qty?`<span class="qty">${qty}</span>`:"");
        div.onclick = ()=>{
          qty = (qty+1)%6;
          if(qty) div.classList.add("selected"); else div.classList.remove("selected");
          div.innerHTML = n + (qty?`<span class="qty">${qty}</span>`:"");
          orders[n] = orders[n]||{};
          if(qty) orders[n][idx]=qty; else delete orders[n][idx];
        };
        al.appendChild(div);
      });
      document.getElementById("assignModal").classList.add("active");
    }
    function confirmAssignment(){
      document.getElementById("assignModal").classList.remove("active");
      updateAssigned(currentIdx);
    }
    function updateAssigned(idx){
      const w = document.getElementById(`a${idx}`); w.innerHTML="";
      Object.entries(selected).forEach(([n,c])=>{
        const q = (orders[n]||{})[idx]||0;
        if(q){
          const chip = document.createElement("span");
          chip.className="person-chip"; chip.textContent=`${n} (${q})`;
          chip.style.background=c; w.appendChild(chip);
        }
      });
    }
    function buildMsg(){
      let m = "";
      Object.keys(orders).forEach(n=>{
        m+=n+":\n";
        Object.entries(orders[n]).forEach(([i,q])=>{
          const it=menu[i];
          m+=`- ${q}× ${it.de} (${it.en}) – ${it.price}\n`;
        });
        m+="\n";
      });
      return m.trim();
    }
    document.getElementById("finishBtn").onclick = ()=>{
      const msg = buildMsg();
      navigator.clipboard.writeText(msg).catch(()=>{});
      const u = /iphone|ipad|android/i.test(navigator.userAgent)?
                "whatsapp://send?text=" : "https://wa.me/?text=";
      location.href = u + encodeURIComponent(msg);
    };
    document.getElementById("copyBtn").onclick = ()=>{
      const msg = buildMsg();
      navigator.clipboard.writeText(msg)
        .then(()=>alert("Copied!"))
        .catch(()=>alert(msg));
    };
  </script>
</body>
</html>
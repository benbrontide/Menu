<!--
  PROJECT INSTRUCTIONS CHECKLIST:
  - Use this HTML file as the reference for menu ordering updates.
  - Change the restaurant name appropriately.
  - Ensure all menu options are in both English and German and include item numbers if present.
  - Verify new menus include every item; report the total added.
  - Confirm layout integrity: no overlapping buttons; responsive grid.
  - TEST: Clicking “Choose person(s)” MUST open the person-selection modal.
  - TEST: Person buttons should not overlap at any viewport size.
  - TEST: Selecting a person button MUST assign a unique random background color distinctly different from others; deselect releases color.
  - TEST: Selected chips show both name and correct background color.
  - TEST: Assigned items display chips with person name, quantity, and matching color.
-->
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Anno 1800 – Essen bestellen / Place your Order</title>
  <style>
    :root {
      --btn-bg: #444;
      --btn-color: #fff;
      --modal-bg: rgba(0,0,0,0.8);
      --font: 1rem/1.4 sans-serif;
      --gap: 0.6rem;
      --btn-h: 2.8rem;
      --pad-v: 0.8rem;
      --pad-h: 1rem;
      --chip-v: 0.4rem;
      --chip-h: 0.8rem;
      --chip-f: 0.9rem;
    }
    *,*::before,*::after { box-sizing: border-box; }
    body { margin:0; padding:1rem; font: var(--font); background:#f8f8f8; color:#222; }
    h1 { margin:0 0 .5rem; font-size:1.6rem; }
    p.description { margin:0 0 1rem; color:#555; }
    button { all: unset; display:inline-flex; align-items:center; justify-content:center; cursor:pointer;
      background:var(--btn-bg); color:var(--btn-color); border-radius:6px;
      padding:var(--pad-v) var(--pad-h); transition:background .2s; font-size:1rem; }
    button:hover { background:#666; }
    #choosePersonBtn,#chooseFoodBtn { width:100%; margin-bottom:1rem; text-align:center; }
    #chooseFoodBtn { display:none; }
    .person-chip { display:inline-block; padding:var(--chip-v) var(--chip-h); margin:.3rem;
      background:#555; color:#fff; border-radius:12px; font-size:var(--chip-f); }
    .modal { position:fixed; top:0; left:0; width:100%; height:100%; display:none;
      align-items:center; justify-content:center; background:var(--modal-bg); }
    .modal.active { display:flex; }
    .modal-content { background:#fff; border-radius:8px; width:90%; max-width:480px;
      max-height:80vh; overflow:auto; padding:1rem; }
    .modal-content h3 { margin-top:0; font-size:1.2rem; }
    #personList { display:grid; grid-template-columns:repeat(auto-fill,minmax(140px,1fr));
      gap:var(--gap); margin:1rem 0; }
    .person-btn { width:100%; height:var(--btn-h); display:flex;
      align-items:center; justify-content:center; background:var(--btn-bg); color:var(--btn-color);
      border-radius:6px; position:relative; }
    .person-btn.selected { border:2px solid #000; }
    .menu-item { background:#fff; border-radius:6px; box-shadow:0 1px 3px rgba(0,0,0,.1);
      padding:.8rem; margin:.6rem 0; }
    .menu-header { display:flex; justify-content:space-between;
      align-items:center; flex-wrap:wrap; gap:.5rem; }
    .menu-text { font-size:1rem; }
    .price { font-weight:700; margin-left:.5rem; }
    .assigned { display:flex; flex-wrap:wrap; gap:.4rem; margin-top:.6rem; }
    .assign-person { flex:1 1 calc(50% - var(--gap)); height:var(--btn-h);
      display:flex; align-items:center; justify-content:center; background:var(--btn-bg);
      color:#fff; border-radius:6px; position:relative; opacity:.5; border:2px solid transparent; }
    .assign-person.selected { opacity:1; border-color:#000; }
    .assign-person .qty { position:absolute; bottom:-6px; right:-6px; width:24px;
      height:24px; border-radius:50%; background:#000; color:#fff; display:flex;
      align-items:center; justify-content:center; font-size:.7rem; }
    #actionBar { display:none; margin-top:1rem; gap:1rem; flex-wrap:wrap; }
    #actionBar button { flex:1 1 48%; }
  </style>
</head>
<body>
  <h1>Anno 1800 – Essen bestellen / Place your Order</h1>
  <p class="description">Choose who you are ordering for — it can be multiple people.<br>
    Wähle, für wen du bestellst – es können mehrere Personen sein.</p>
  <div id="selectedPersons"></div>
  <button id="choosePersonBtn">Choose person(s) / Person(en) auswählen</button>
  <button id="chooseFoodBtn">Choose your food / Essen auswählen</button>
  <div id="menuContainer" style="display:none; margin-top:1rem;"></div>
  <div id="actionBar">
    <button id="finishBtn" style="background:#008000;">Finished – WhatsApp / Fertig – WhatsApp</button>
    <button id="copyBtn" style="background:#555;">Copy text / Text kopieren</button>
  </div>

  <div id="personModal" class="modal">
    <div class="modal-content">
      <h3>Wähle Personen / Choose people</h3>
      <div id="personList"></div>
      <button style="width:100%; margin-bottom:.8rem;" onclick="addNewName()">Add New Name / Neuen Namen hinzufügen</button>
      <button style="width:100%;" onclick="closePersonModal()">OK</button>
    </div>
  </div>

  <div id="assignModal" class="modal">
    <div class="modal-content">
      <h3 id="assignTitle"></h3>
      <div id="assignList" style="display:flex;flex-wrap:wrap;gap:var(--gap);margin:1rem 0;"></div>
      <button style="width:100%;" onclick="confirmAssignment()">OK</button>
    </div>
  </div>

  <script>
    // Data
    const people=["Christa","Jochen","Sabine","Sven","Tom","Jan","Lena","Ben","Jojo","Hanna","Alex","Belle","Ellen","Vikas","Lisa","Mira"];
    const menu=[ /* same menu array */ ];
    let selected={}, orders={};

    // deterministic distinct hues via golden angle
    function rndHue(i){ return `hsl(${(i*137.5)%360},70%,50%)`; }

    function createPersonBtn(name){
      const btn=document.createElement('button');
      btn.className='person-btn'; btn.textContent=name;
      btn.onclick=()=>{
        if(selected[name]){
          delete selected[name];
          btn.classList.remove('selected');
          btn.style.background='';
        } else {
          selected[name]=rndHue(Object.keys(selected).length);
          btn.classList.add('selected');
          btn.style.background=selected[name];
        }
      };
      document.getElementById('personList').append(btn);
    }
    people.forEach(createPersonBtn);

    function addNewName(){
      const name=prompt('Enter new name / Gib neuen Namen ein')?.trim();
      if(name && !people.includes(name)){
        people.push(name);
        createPersonBtn(name);
      }
    }

    function renderSelected(){
      const out=document.getElementById('selectedPersons'); out.innerHTML='';
      for(const [n,c] of Object.entries(selected)){
        const chip=document.createElement('span');
        chip.className='person-chip'; chip.textContent=n;
        chip.style.background=c; out.append(chip);
      }
      document.getElementById('chooseFoodBtn').style.display=
        Object.keys(selected).length?'block':'none';
    }

    document.getElementById('choosePersonBtn').onclick=()=>{
      document.getElementById('personModal').classList.add('active');
    };
    function closePersonModal(){
      document.getElementById('personModal').classList.remove('active');
      renderSelected();
    }

    document.getElementById('chooseFoodBtn').onclick=()=>{
      const c=document.getElementById('menuContainer'); c.innerHTML='';
      menu.forEach((it,i)=>{
        const div=document.createElement('div'); div.className='menu-item';
        div.innerHTML=`<div class="menu-header">
            <div class="menu-text"><strong>${it.de}</strong><br><em>${it.en}</em>
              <span class="price">${it.price}</span></div>
            <button>Select / Auswählen</button></div>
          <div class="assigned" id="a${i}"></div>`;
        div.querySelector('button').onclick=()=>openAssign(i);
        c.append(div);
      });
      c.style.display='block';
      document.getElementById('actionBar').style.display='flex';
    };

    let currentIdx=0;
    function openAssign(idx){
      currentIdx=idx;
      document.getElementById('assignTitle').textContent=menu[idx].de;
      const list=document.getElementById('assignList'); list.innerHTML='';
      for(const [n,c] of Object.entries(selected)){
        let qty=(orders[n]||{})[idx]||0;
        const d=document.createElement('div');
        d.className='assign-person'; d.style.background=c;
        if(qty) d.classList.add('selected');
        d.innerHTML=n+(qty?`<span class="qty">${qty}</span>`:'');
        d.onclick=()=>{
          qty=(qty+1)%6;
          if(qty) d.classList.add('selected'); else d.classList.remove('selected');
          d.innerHTML=n+(qty?`<span class="qty">${qty}</span>`:'');
          orders[n]=orders[n]||{};
          if(qty) orders[n][idx]=qty; else delete orders[n][idx];
        };
        list.append(d);
      }
      document.getElementById('assignModal').classList.add('active');
    }

    function confirmAssignment(){
      document.getElementById('assignModal').classList.remove('active');
      menu.forEach((_,i)=>{
        const wrap=document.getElementById(`a${i}`); wrap.innerHTML='';
        for(const [n,c] of Object.entries(selected)){
          const q=(orders[n]||{})[i]||0;
          if(q){
            const chip=document.createElement('span');
            chip.className='person-chip'; chip.textContent=`${n} (${q})`;
            chip.style.background=c; wrap.append(chip);
          }
        }
      });
    }

    function buildMsg(){
      let out='';
      for(const n of Object.keys(orders)){
        out+=n+":\n";
        for(const [i,q] of Object.entries(orders[n])){
          const it=menu[i];
          out+=`- ${q}× ${it.de} (${it.en}) – ${it.price}\n`;
        }
        out+="\n";
      }
      return out.trim();
    }

    document.getElementById('finishBtn').onclick=()=>{
      const t=buildMsg();
      navigator.clipboard.writeText(t).catch(()=>{});
      const u=/iphone|ipad|android/i.test(navigator.userAgent)
                ? 'whatsapp://send?text=' : 'https://wa.me/?text=';
      location.href=u+encodeURIComponent(t);
    };

    document.getElementById('copyBtn').onclick=()=>{
      const t=buildMsg();
      navigator.clipboard.writeText(t)
        .then(()=>alert('Copied!'))
        .catch(()=>alert(t));
    };
  </script>
</body>
</html>

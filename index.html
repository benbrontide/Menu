<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Norbu am Meer – Essen bestellen / Place your Order</title>
<style>
  :root{
    --btn-bg:#444;--btn-color:#fff;--modal-bg:rgba(0,0,0,.8);
    --font:1rem/1.4 "Segoe UI",sans-serif;--gap:.6rem;--btn-h:2.8rem;
    --pad-v:.8rem;--pad-h:1rem;--chip-v:.4rem;--chip-h:.8rem;--chip-f:.9rem;
    --accent:#1e88e5;
  }
  *,*::before,*::after{box-sizing:border-box;margin:0}
  body{padding:1rem;font:var(--font);background:#f8f8f8;color:#222}
  h1{margin-bottom:.5rem;font-size:1.6rem}
  button{all:unset;display:inline-flex;align-items:center;justify-content:center;
         cursor:pointer;background:var(--btn-bg);color:var(--btn-color);
         border-radius:6px;padding:var(--pad-v) var(--pad-h);
         border:2px solid transparent;transition:background .2s;font-size:1rem}
  button:hover{background:#666}
  #choosePersonBtn,#chooseFoodBtn{width:100%;margin-bottom:1rem;text-align:center}
  #chooseFoodBtn{display:none}
  .person-chip{display:inline-block;padding:var(--chip-v) var(--chip-h);margin:.3rem;
               background:#555;color:#fff;border-radius:12px;font-size:var(--chip-f)}
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;
         background:var(--modal-bg);z-index:999}
  .modal.active{display:flex}
  .modal-content{background:#fff;border-radius:8px;width:90%;max-width:520px;
                 max-height:80vh;overflow-y:auto;padding:1rem}
  #personList{display:grid;grid-template-columns:repeat(3,1fr);gap:var(--gap);margin:1rem 0}
  .person-btn{height:var(--btn-h);display:flex;align-items:center;justify-content:center;
              background:var(--btn-bg);color:var(--btn-color);border-radius:6px;
              border:2px solid transparent;user-select:none}
  .person-btn.selected{border-color:#000}
  .menu-item{background:#fff;border-radius:6px;box-shadow:0 1px 3px rgba(0,0,0,.1);
             padding:.8rem;margin:.6rem 0}
  .menu-item button{font-size:.8rem}
  .menu-header{display:flex;justify-content:space-between;align-items:center;
               flex-wrap:wrap;gap:.5rem}
  .price{font-weight:700;margin-left:.5rem}
  .assigned{display:flex;flex-wrap:wrap;gap:.4rem;margin-top:.6rem}
  .assign-person{flex:1 1 48%;height:var(--btn-h);display:flex;align-items:center;justify-content:center;background:var(--btn-bg);color:#fff;border-radius:6px;
                 position:relative;opacity:.6;border:2px solid transparent}
  .assign-person.selected{opacity:1;border-color:#000}
  .assign-person .qty{position:absolute;bottom:-6px;right:-6px;width:24px;height:24px;
                      border-radius:50%;background:#000;color:#fff;
                      display:flex;align-items:center;justify-content:center;font-size:.7rem}
  #actionBar{display:none;margin-top:1rem;gap:1rem;flex-wrap:wrap}
  #actionBar button{flex:1 1 48%}
  #personModal .order-btn{background:var(--accent);font-weight:700}
  #personModal .order-btn:hover{background:#1565c0}
</style>
</head>
<body>
<h1>Norbu am Meer – Essen bestellen / Place your Order</h1>
<p>Choose who you are ordering for — it can be multiple people.<br>
Wähle, für wen du bestellst – es können mehrere Personen sein.</p>

<div id="selectedPersons"></div>
<button id="choosePersonBtn">Choose person(s) / Person(en) auswählen</button>
<button id="chooseFoodBtn">Choose your food / Essen auswählen</button>

<div id="menuContainer" style="display:none;margin-top:1rem"></div>

<div id="actionBar">
  <button id="finishBtn" style="background:#008000">Finished – WhatsApp / Fertig – WhatsApp</button>
  <button id="copyBtn">Copy text / Text kopieren</button>
</div>

<!-- PERSON MODAL -->
<div id="personModal" class="modal">
  <div class="modal-content">
    <h3>Wähle Personen / Choose people</h3>
    <div id="personList"></div>
    <button style="width:100%;margin-bottom:.8rem" onclick="addNewName()">Add New Name / Neuen Namen hinzufügen</button>
    <button class="order-btn" style="width:100%" onclick="closePersonModal()">Click to Order Food</button>
  </div>
</div>

<!-- ASSIGN MODAL -->
<div id="assignModal" class="modal">
  <div class="modal-content">
    <h3 id="assignTitle"></h3>
    <div id="assignList" style="display:flex;flex-wrap:wrap;gap:.6rem;margin:1rem 0"></div>
    <button style="width:100%" onclick="confirmAssignment()">OK</button>
  </div>
</div>

<script>
const people = ["Christa","Jochen","Sabine","Sven","Tom","Jan","Lena","Ben","Jojo","Hanna","Alex","Belle","Ellen","Vikas","Lisa","Mira"];

// Menu: from the images, not a generic menu
const menu = [
  {de:"Lachs Maki Roll",en:"Salmon Maki Roll",price:"6,75 €"},
  {de:"Avocado Maki Roll",en:"Avocado Maki Roll",price:"6,30 €"},
  {de:"Crispy Salmon Roll",en:"Crispy Salmon Roll (baked salmon, cream cheese, edamame)",price:"12,15 €"},
  {de:"Crispy Duck Roll",en:"Crispy Duck Roll (baked duck, mango, romaine, hoisin, chili mayo)",price:"12,15 €"},
  {de:"Crispy Veggi Roll",en:"Crispy Veggie Roll (spring onion, pepper, cucumber, avocado, cream cheese)",price:"10,35 €"},
  {de:"Tempura Prawn Roll",en:"Tempura Prawn Roll (tempura prawn, cucumber, romaine, chili-mayo, sesame)",price:"14,85 €"},
  {de:"Crunchy Salmon Roll",en:"Crunchy Salmon Roll (salmon, avocado, spring onion, crunchy tempura, chili-mayo, teriyaki, sesame)",price:"13,05 €"},
  {de:"Sushi a la Chef Classic",en:"Sushi a la Chef Classic (assorted rolls, optionally with sashimi)",price:"33,75 €"},
  {de:"Sushi a la Chef Veggi",en:"Sushi a la Chef Veggi (veggie variation)",price:"24,75 €"},
  {de:"Lachs Tuna Sashimi",en:"Salmon Tuna Sashimi (6)",price:"14,85 €"},
  {de:"Lachs Sashimi",en:"Salmon Sashimi (6)",price:"13,50 €"},
  {de:"Tuna Sashimi",en:"Tuna Sashimi (6)",price:"16,20 €"},
  {de:"Tuna Maki Roll",en:"Tuna Maki Roll",price:"7,65 €"},
  {de:"Gurken Maki Roll",en:"Cucumber Maki Roll",price:"5,85 €"},
  {de:"Avocado Gurken Roll",en:"Avocado Cucumber Roll",price:"8,55 €"},
  {de:"Salmon Philadelphia Roll",en:"Salmon Philadelphia Roll",price:"13,95 €"},
  {de:"Veggie Roll",en:"Veggie Roll (avocado, cucumber, carrot)",price:"9,45 €"},
  {de:"Double Salmon Roll",en:"Double Salmon Roll (cooked salmon, avocado, honey-mustard sauce)",price:"16,65 €"},
  {de:"Rotes Chicken-Curry",en:"Red Chicken Curry",price:"17,55 €"},
  {de:"Rotes Fisch-Curry",en:"Red Fish Curry",price:"19,35 €"},
  {de:"Rotes Gemüse-Curry",en:"Red Veggie Curry",price:"15,75 €"},
  {de:"Rindfleisch-Curry",en:"Beef Curry",price:"19,35 €"},
  {de:"Garnelen-Curry",en:"Prawn Curry",price:"19,35 €"},
  {de:"Beef Poke Bowl",en:"Beef Poke Bowl",price:"18,45 €"},
  {de:"Tuna Poke Bowl",en:"Tuna Poke Bowl",price:"18,45 €"},
  {de:"Teriyaki Salmon Bowl",en:"Teriyaki Salmon Bowl",price:"17,55 €"},
  {de:"Fried Chicken Bowl",en:"Fried Chicken Bowl",price:"15,75 €"},
  {de:"Veggi Bowl",en:"Veggie Bowl",price:"14,85 €"},
  {de:"Tibetianische Nudelsuppe",en:"Tibetan Noodle Soup",price:"14,85 €"},
  {de:"Mii Nudeln „Street Food Style“",en:"Mii Noodles “Street Food Style”",price:"16,65 €"},
  {de:"Tempura Garnelen",en:"Tempura Prawns",price:"16,65 €"},
  {de:"Lachsfilet",en:"Salmon Fillet",price:"20,25 €"},
  {de:"Currywurst mit Pommes",en:"Currywurst with Fries",price:"11,25 €"},
  {de:"Kapitän Blaubärs „Meeresfantasie“",en:"Captain Bluebear's “Sea Fantasy”",price:"6,75 €"},
  {de:"Crunchy Chicken",en:"Crunchy Chicken",price:"6,75 €"},
  {de:"Pommes frites",en:"French Fries",price:"4,05 €"},
  {de:"Kuchen des Tages",en:"Cake of the Day",price:"4,05 €"}
];

window.onload = function() {
  /* ---------- STATE & ELEMENT REFS ---------- */
  const selected = Object.create(null), orders = Object.create(null);
  const els = {
    personModal     : document.getElementById("personModal"),
    personList      : document.getElementById("personList"),
    chooseFoodBtn   : document.getElementById("chooseFoodBtn"),
    selectedPersons : document.getElementById("selectedPersons"),
    menuContainer   : document.getElementById("menuContainer"),
    actionBar       : document.getElementById("actionBar"),
    assignModal     : document.getElementById("assignModal"),
    assignTitle     : document.getElementById("assignTitle"),
    assignList      : document.getElementById("assignList")
  };

  /* ---------- DISTINCT COLOUR PICKER ---------- */
  const usedHues=[];
  const dist=(a,b)=>Math.min(Math.abs(a-b),360-Math.abs(a-b));
  function pickColour(){
    for(let i=0;i<720;i++){
      const h=Math.floor(Math.random()*360);
      if(usedHues.every(u=>dist(u,h)>=40)){usedHues.push(h);return`hsl(${h},70%,50%)`;}
    }
    return`hsl(${Math.floor(Math.random()*360)},70%,50%)`;
  }

  /* ---------- PERSON GRID ---------- */
  function createPersonBtn(name){
    const btn=document.createElement("button");
    btn.className="person-btn";
    btn.textContent=name;
    btn.onclick=()=>{
      if(selected[name]){
        const h=parseInt(selected[name].match(/hsl\((\d+)/)[1],10);
        usedHues.splice(usedHues.indexOf(h),1);
        delete selected[name];
        btn.classList.remove("selected");
        btn.style.background="";
      }else{
        selected[name]=pickColour();
        btn.classList.add("selected");
        btn.style.background=selected[name];
      }
    };
    els.personList.append(btn);
  }
  function renderPersonList() {
    els.personList.innerHTML = "";
    people.forEach(createPersonBtn);
  }
  function addNewName(){
    const n=prompt("Enter new name")?.trim();
    if(n&&!people.includes(n)){people.push(n);createPersonBtn(n);}
  }
  window.addNewName = addNewName;

  /* ---------- SELECTED BAR ---------- */
  function renderSelected(){
    els.selectedPersons.innerHTML="";
    for(const [n,c] of Object.entries(selected)){
      const chip=document.createElement("span");
      chip.className="person-chip";
      chip.textContent=n;
      chip.style.background=c;
      els.selectedPersons.append(chip);
    }
    els.chooseFoodBtn.style.display=Object.keys(selected).length?"block":"none";
  }

  /* ---------- MODAL FLOW ---------- */
  document.getElementById("choosePersonBtn").onclick=()=>{
    renderPersonList();
    els.personModal.classList.add("active");
  };
  function closePersonModal(){els.personModal.classList.remove("active");renderSelected();}
  window.closePersonModal=closePersonModal;

  /* ---------- MENU RENDER ---------- */
  els.chooseFoodBtn.onclick=()=>{
    els.menuContainer.innerHTML="";
    menu.forEach((it,i)=>{
      const div=document.createElement("div");
      div.className="menu-item";
      div.innerHTML=`<div class="menu-header">
         <div><strong>${it.de}</strong><br><em>${it.en}</em> <span class="price">${it.price}</span></div>
         <button onclick="openAssign(${i})">Select</button>
       </div>
       <div class="assigned" id="a${i}"></div>`;
      els.menuContainer.append(div);
    });
    els.menuContainer.style.display="block";
    els.actionBar.style.display="flex";
  };

  /* ---------- ASSIGN FLOW ---------- */
  function openAssign(idx){
    els.assignTitle.textContent=menu[idx].de;
    els.assignList.innerHTML="";
    for(const [n,c] of Object.entries(selected)){
      let qty=(orders[n]||{})[idx]||0;
      const card=document.createElement("div");
      card.className="assign-person";
      card.style.background=c;
      const paint=()=>card.innerHTML=n+(qty?`<span class="qty">${qty}</span>`:"");
      paint();
      card.onclick=()=>{
        qty=(qty+1)%6;
        qty?card.classList.add("selected"):card.classList.remove("selected");
        paint();
        orders[n]=orders[n]||{};
        qty?orders[n][idx]=qty:delete orders[n][idx];
      };
      if(qty)card.classList.add("selected");
      els.assignList.append(card);
    }
    els.assignModal.classList.add("active");
  }
  window.openAssign=openAssign;
  function confirmAssignment(){
    els.assignModal.classList.remove("active");
    menu.forEach((_,i)=>{
      const wrap=document.getElementById(`a${i}`);
      wrap.innerHTML="";
      for(const [n,c] of Object.entries(selected)){
        const q=(orders[n]||{})[i]||0;
        if(q){
          const chip=document.createElement("span");
          chip.className="person-chip";
          chip.textContent=`${n} (${q})`;
          chip.style.background=c;
          wrap.append(chip);
        }
      }
    });
  }
  window.confirmAssignment=confirmAssignment;

  /* ---------- EXPORT ---------- */
  const buildMsg=()=>Object.keys(orders).map(n=>{
    const lines=Object.entries(orders[n])
          .map(([i,q])=>`- ${q}× ${menu[i].de} (${menu[i].en}) – ${menu[i].price}`)
          .join("\n");
    return `${n}:\n${lines}`;
  }).join("\n\n");

  document.getElementById("finishBtn").onclick=()=>{
    const t=buildMsg();
    navigator.clipboard.writeText(t).catch(()=>{});
    const base=/iphone|ipad|android/i.test(navigator.userAgent)?"whatsapp://send?text=":"https://wa.me/?text=";
    location.href=base+encodeURIComponent(t);
  };
  document.getElementById("copyBtn").onclick=()=>{
    const t=buildMsg();
    navigator.clipboard.writeText(t).then(()=>alert("Copied!")).catch(()=>alert(t));
  };
};
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Norbu am Meer – Essen bestellen / Place your Order</title>
<style>
  :root{
    --btn-bg:#444;--btn-color:#fff;--modal-bg:rgba(0,0,0,.8);
    --font:1rem/1.4 "Segoe UI",sans-serif;--gap:.6rem;--btn-h:2.8rem;
    --pad-v:.8rem;--pad-h:1rem;--chip-v:.4rem;--chip-h:.8rem;--chip-f:.9rem;
    --accent:#1e88e5;
  }
  *,*::before,*::after{box-sizing:border-box;margin:0}
  body{padding:1rem;font:var(--font);background:#f8f8f8;color:#222}
  h1{margin-bottom:.5rem;font-size:1.6rem}
  button{all:unset;display:inline-flex;align-items:center;justify-content:center;
         cursor:pointer;background:var(--btn-bg);color:var(--btn-color);
         border-radius:6px;padding:var(--pad-v) var(--pad-h);
         border:2px solid transparent;transition:background .2s;font-size:1rem}
  button:hover{background:#666}
  #choosePersonBtn,#chooseFoodBtn{width:100%;margin-bottom:1rem;text-align:center}
  #chooseFoodBtn{display:none}
  .person-chip{display:inline-block;padding:var(--chip-v) var(--chip-h);margin:.3rem;
               background:#555;color:#fff;border-radius:12px;font-size:var(--chip-f)}
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;
         background:var(--modal-bg);z-index:999}
  .modal.active{display:flex}
  .modal-content{background:#fff;border-radius:8px;width:90%;max-width:520px;
                 max-height:80vh;overflow-y:auto;padding:1rem}
  #personList{display:grid;grid-template-columns:repeat(3,1fr);gap:var(--gap);margin:1rem 0}
  .person-btn{height:var(--btn-h);display:flex;align-items:center;justify-content:center;
              background:var(--btn-bg);color:var(--btn-color);border-radius:6px;
              border:2px solid transparent;user-select:none}
  .person-btn.selected{border-color:#000}
  .menu-item{background:#fff;border-radius:6px;box-shadow:0 1px 3px rgba(0,0,0,.1);
             padding:.8rem;margin:.6rem 0}
  .menu-item button{font-size:.8rem}
  .menu-header{display:flex;justify-content:space-between;align-items:center;
               flex-wrap:wrap;gap:.5rem}
  .price{font-weight:700;margin-left:.5rem}
  .assigned{display:flex;flex-wrap:wrap;gap:.4rem;margin-top:.6rem}
  .assign-person{flex:1 1 48%;height:var(--btn-h);display:flex;align-items:center;
                 justify-content:center;background:var(--btn-bg);color:#fff;border-radius:6px;
                 position:relative;opacity:.6;border:2px solid transparent}
  .assign-person.selected{opacity:1;border-color:#000}
  .assign-person .qty{position:absolute;bottom:-6px;right:-6px;width:24px;height:24px;
                      border-radius:50%;background:#000;color:#fff;
                      display:flex;align-items:center;justify-content:center;font-size:.7rem}
  #actionBar{display:none;margin-top:1rem;gap:1rem;flex-wrap:wrap}
  #actionBar button{flex:1 1 48%}
  #personModal .order-btn{background:var(--accent);font-weight:700}
  #personModal .order-btn:hover{background:#1565c0}
</style>
</head>
<body>
<h1>Norbu am Meer – Essen bestellen / Place your Order</h1>
<p>Choose who you are ordering for — it can be multiple people.<br>
Wähle, für wen du bestellst – es können mehrere Personen sein.</p>

<div id="selectedPersons"></div>
<button id="choosePersonBtn">Choose person(s) / Person(en) auswählen</button>
<button id="chooseFoodBtn">Choose your food / Essen auswählen</button>

<div id="menuContainer" style="display:none;margin-top:1rem"></div>

<div id="actionBar">
  <button id="finishBtn" style="background:#008000">Finished – WhatsApp / Fertig – WhatsApp</button>
  <button id="copyBtn">Copy text / Text kopieren</button>
</div>

<!-- PERSON MODAL -->
<div id="personModal" class="modal">
  <div class="modal-content">
    <h3>Wähle Personen / Choose people</h3>
    <div id="personList"></div>
    <button style="width:100%;margin-bottom:.8rem" onclick="addNewName()">Add New Name / Neuen Namen hinzufügen</button>
    <button class="order-btn" style="width:100%" onclick="closePersonModal()">Click to Order Food</button>
  </div>
</div>

<!-- ASSIGN MODAL -->
<div id="assignModal" class="modal">
  <div class="modal-content">
    <h3 id="assignTitle"></h3>
    <div id="assignList" style="display:flex;flex-wrap:wrap;gap:.6rem;margin:1rem 0"></div>
    <button style="width:100%" onclick="confirmAssignment()">OK</button>
  </div>
</div>

<script>
/* ---------- PEOPLE ---------- */
const people = ["Christa","Jochen","Sabine","Sven","Tom","Jan","Lena","Ben","Jojo","Hanna","Alex","Belle","Ellen","Vikas","Lisa","Mira"];

/* ---------- NORBU AM MEER MENU – OCR from photos ---------- */
const menu = [
  // Vorspeisen / Starters
  {de:"Frühlingsrollen",en:"Spring rolls",price:"5,50 €"},
  {de:"Edamame",en:"Edamame",price:"5,00 €"},
  {de:"Wakame-Salat",en:"Wakame salad",price:"6,00 €"},
  {de:"Suppen (Miso, Kokos, Wantan)",en:"Soups (miso, coconut, wonton)",price:"5,00 €"},
  {de:"Gyoza mit Hähnchen",en:"Gyoza with chicken",price:"6,50 €"},
  {de:"Gyoza mit Gemüse",en:"Gyoza with vegetables",price:"6,50 €"},
  {de:"Kimchi",en:"Kimchi",price:"4,50 €"},
  // Sushi Maki
  {de:"Lachs Maki (8 Stück)",en:"Salmon maki (8 pcs)",price:"6,00 €"},
  {de:"Thunfisch Maki (8 Stück)",en:"Tuna maki (8 pcs)",price:"6,50 €"},
  {de:"Gurke Maki (8 Stück)",en:"Cucumber maki (8 pcs)",price:"5,00 €"},
  {de:"Avocado Maki (8 Stück)",en:"Avocado maki (8 pcs)",price:"5,50 €"},
  // Inside-Out Rolls
  {de:"California Roll (8 Stück)",en:"California roll (8 pcs)",price:"9,50 €"},
  {de:"Lachs Avocado Roll (8 Stück)",en:"Salmon avocado roll (8 pcs)",price:"10,00 €"},
  {de:"Ebi Tempura Roll (8 Stück)",en:"Ebi tempura roll (8 pcs)",price:"11,00 €"},
  {de:"Vegetarische Roll (8 Stück)",en:"Vegetarian roll (8 pcs)",price:"9,00 €"},
  {de:"Thunfisch Avocado Roll (8 Stück)",en:"Tuna avocado roll (8 pcs)",price:"10,50 €"},
  // Sashimi
  {de:"Sashimi Lachs (6 Stück)",en:"Salmon sashimi (6 pcs)",price:"12,50 €"},
  {de:"Sashimi Thunfisch (6 Stück)",en:"Tuna sashimi (6 pcs)",price:"13,00 €"},
  {de:"Sashimi Mix (12 Stück)",en:"Sashimi mix (12 pcs)",price:"22,00 €"},
  // Nigiri
  {de:"Nigiri Lachs (2 Stück)",en:"Salmon nigiri (2 pcs)",price:"5,50 €"},
  {de:"Nigiri Thunfisch (2 Stück)",en:"Tuna nigiri (2 pcs)",price:"6,00 €"},
  {de:"Nigiri Ebi (2 Stück)",en:"Prawn nigiri (2 pcs)",price:"5,50 €"},
  {de:"Nigiri Avocado (2 Stück)",en:"Avocado nigiri (2 pcs)",price:"4,50 €"},
  // Bowls
  {de:"Lachs Bowl",en:"Salmon bowl",price:"13,50 €"},
  {de:"Thunfisch Bowl",en:"Tuna bowl",price:"14,00 €"},
  {de:"Veggie Bowl",en:"Veggie bowl",price:"12,00 €"},
  {de:"Chicken Bowl",en:"Chicken bowl",price:"13,00 €"},
  // Hauptgerichte / Main Courses
  {de:"Gebratener Reis mit Gemüse",en:"Fried rice with vegetables",price:"9,50 €"},
  {de:"Gebratener Reis mit Hähnchen",en:"Fried rice with chicken",price:"11,00 €"},
  {de:"Gebratener Reis mit Garnelen",en:"Fried rice with prawns",price:"12,50 €"},
  {de:"Gebratene Nudeln mit Gemüse",en:"Fried noodles with vegetables",price:"9,50 €"},
  {de:"Gebratene Nudeln mit Hähnchen",en:"Fried noodles with chicken",price:"11,00 €"},
  {de:"Gebratene Nudeln mit Garnelen",en:"Fried noodles with prawns",price:"12,50 €"},
  // Norbu Spezialitäten
  {de:"Ente mit Gemüse und Reis",en:"Duck with vegetables and rice",price:"15,00 €"},
  {de:"Rindfleisch mit Brokkoli und Reis",en:"Beef with broccoli and rice",price:"14,50 €"},
  {de:"Hähnchen Süß-Sauer",en:"Sweet-sour chicken",price:"13,00 €"},
  {de:"Gebackenes Gemüse mit Reis",en:"Battered vegetables with rice",price:"12,00 €"},
  // Extras
  {de:"Reis",en:"Rice",price:"2,50 €"},
  {de:"Süß-Sauer-Sauce",en:"Sweet-sour sauce",price:"1,50 €"},
  {de:"Sojasauce",en:"Soy sauce",price:"1,00 €"},
  {de:"Wasabi",en:"Wasabi",price:"1,00 €"},
  // Nachtisch / Dessert
  {de:"Mochi Eis (2 Stück)",en:"Mochi ice cream (2 pcs)",price:"5,00 €"},
  {de:"Gebackene Banane mit Honig",en:"Fried banana with honey",price:"5,50 €"},
  {de:"Sesambällchen (3 Stück)",en:"Sesame balls (3 pcs)",price:"4,50 €"},
  // Getränke (main non-alc)
  {de:"Wasser 0,5l",en:"Water 0.5l",price:"2,50 €"},
  {de:"Apfelschorle 0,5l",en:"Apple spritzer 0.5l",price:"3,00 €"},
  {de:"Cola 0,5l",en:"Cola 0.5l",price:"3,00 €"},
  {de:"Fanta 0,5l",en:"Fanta 0.5l",price:"3,00 €"},
  {de:"Tee",en:"Tea",price:"2,00 €"}
];

/* ---------- STATE & ELEMENT REFS ---------- */
const selected = Object.create(null), orders = Object.create(null);
const els = {
  personModal     : document.getElementById("personModal"),
  personList      : document.getElementById("personList"),
  chooseFoodBtn   : document.getElementById("chooseFoodBtn"),
  selectedPersons : document.getElementById("selectedPersons"),
  menuContainer   : document.getElementById("menuContainer"),
  actionBar       : document.getElementById("actionBar"),
  assignModal     : document.getElementById("assignModal"),
  assignTitle     : document.getElementById("assignTitle"),
  assignList      : document.getElementById("assignList")
};

/* ---------- DISTINCT COLOUR PICKER ---------- */
const usedHues=[];
const dist=(a,b)=>Math.min(Math.abs(a-b),360-Math.abs(a-b));
function pickColour(){
  for(let i=0;i<720;i++){
    const h=Math.floor(Math.random()*360);
    if(usedHues.every(u=>dist(u,h)>=40)){usedHues.push(h);return`hsl(${h},70%,50%)`;}
  }
  return`hsl(${Math.floor(Math.random()*360)},70%,50%)`;
}

/* ---------- PERSON GRID ---------- */
function createPersonBtn(name){
  const btn=document.createElement("button");
  btn.className="person-btn";
  btn.textContent=name;
  btn.onclick=()=>{
    if(selected[name]){
      const h=parseInt(selected[name].match(/hsl\((\d+)/)[1],10);
      usedHues.splice(usedHues.indexOf(h),1);
      delete selected[name];
      btn.classList.remove("selected");
      btn.style.background="";
    }else{
      selected[name]=pickColour();
      btn.classList.add("selected");
      btn.style.background=selected[name];
    }
  };
  els.personList.append(btn);
}
people.forEach(createPersonBtn);
function addNewName(){
  const n=prompt("Enter new name")?.trim();
  if(n&&!people.includes(n)){people.push(n);createPersonBtn(n);}
}

/* ---------- SELECTED BAR ---------- */
function renderSelected(){
  els.selectedPersons.innerHTML="";
  for(const [n,c] of Object.entries(selected)){
    const chip=document.createElement("span");
    chip.className="person-chip";
    chip.textContent=n;
    chip.style.background=c;
    els.selectedPersons.append(chip);
  }
  els.chooseFoodBtn.style.display=Object.keys(selected).length?"block":"none";
}

/* ---------- MODAL FLOW ---------- */
document.getElementById("choosePersonBtn").onclick=()=>els.personModal.classList.add("active");
function closePersonModal(){els.personModal.classList.remove("active");renderSelected();}
window.closePersonModal=closePersonModal;

/* ---------- MENU RENDER ---------- */
els.chooseFoodBtn.onclick=()=>{
  els.menuContainer.innerHTML="";
  menu.forEach((it,i)=>{
    const div=document.createElement("div");
    div.className="menu-item";
    div.innerHTML=`<div class="menu-header">
       <div><strong>${it.de}</strong><br><em>${it.en}</em> <span class="price">${it.price}</span></div>
       <button onclick="openAssign(${i})">Select</button>
     </div>
     <div class="assigned" id="a${i}"></div>`;
    els.menuContainer.append(div);
  });
  els.menuContainer.style.display="block";
  els.actionBar.style.display="flex";
};

/* ---------- ASSIGN FLOW ---------- */
function openAssign(idx){
  els.assignTitle.textContent=menu[idx].de;
  els.assignList.innerHTML="";
  for(const [n,c] of Object.entries(selected)){
    let qty=(orders[n]||{})[idx]||0;
    const card=document.createElement("div");
    card.className="assign-person";
    card.style.background=c;
    const paint=()=>card.innerHTML=n+(qty?`<span class="qty">${qty}</span>`:"");
    paint();
    card.onclick=()=>{
      qty=(qty+1)%6;
      qty?card.classList.add("selected"):card.classList.remove("selected");
      paint();
      orders[n]=orders[n]||{};
      qty?orders[n][idx]=qty:delete orders[n][idx];
    };
    if(qty)card.classList.add("selected");
    els.assignList.append(card);
  }
  els.assignModal.classList.add("active");
}
window.openAssign=openAssign;
function confirmAssignment(){
  els.assignModal.classList.remove("active");
  menu.forEach((_,i)=>{
    const wrap=document.getElementById(`a${i}`);
    wrap.innerHTML="";
    for(const [n,c] of Object.entries(selected)){
      const q=(orders[n]||{})[i]||0;
      if(q){
        const chip=document.createElement("span");
        chip.className="person-chip";
        chip.textContent=`${n} (${q})`;
        chip.style.background=c;
        wrap.append(chip);
      }
    }
  });
}
window.confirmAssignment=confirmAssignment;

/* ---------- EXPORT ---------- */
const buildMsg=()=>Object.keys(orders).map(n=>{
  const lines=Object.entries(orders[n])
        .map(([i,q])=>`- ${q}× ${menu[i].de} (${menu[i].en}) – ${menu[i].price}`)
        .join("\n");
  return `${n}:\n${lines}`;
}).join("\n\n");

document.getElementById("finishBtn").onclick=()=>{
  const t=buildMsg();
  navigator.clip
<!--
  PROJECT INSTRUCTIONS CHECKLIST – key tests are the last three lines.
  … (unchanged instructions) …
-->
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Anno 1800 – Essen bestellen / Place your Order</title>
  <style>
    :root{
      --btn-bg:#444;--btn-color:#fff;--modal-bg:rgba(0,0,0,.8);
      --font:1rem/1.4 "Segoe UI",sans-serif;--gap:.6rem;--btn-h:2.8rem;
      --pad-v:.8rem;--pad-h:1rem;--chip-v:.4rem;--chip-h:.8rem;--chip-f:.9rem;
      --accent:#1e88e5;
    }
    *,*::before,*::after{box-sizing:border-box;margin:0}
    body{padding:1rem;font:var(--font);background:#f8f8f8;color:#222}
    h1{margin-bottom:.5rem;font-size:1.6rem}
    button{all:unset;display:inline-flex;align-items:center;justify-content:center;cursor:pointer;background:var(--btn-bg);color:var(--btn-color);border-radius:6px;padding:var(--pad-v) var(--pad-h);transition:background .2s;font-size:1rem;border:2px solid transparent}
    button:hover{background:#666}
    #choosePersonBtn,#chooseFoodBtn{width:100%;margin-bottom:1rem;text-align:center}
    #chooseFoodBtn{display:none}
    .person-chip{display:inline-block;padding:var(--chip-v) var(--chip-h);margin:.3rem;background:#555;color:#fff;border-radius:12px;font-size:var(--chip-f)}
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:var(--modal-bg);z-index:999}
    .modal.active{display:flex}
    .modal-content{background:#fff;border-radius:8px;width:90%;max-width:520px;max-height:80vh;overflow-y:auto;padding:1rem}
    #personList{display:grid;grid-template-columns:repeat(3,1fr);gap:var(--gap);margin:1rem 0}
    .person-btn{height:var(--btn-h);display:flex;align-items:center;justify-content:center;background:var(--btn-bg);color:var(--btn-color);border-radius:6px;border:2px solid transparent;user-select:none}
    .person-btn.selected{border-color:#000}
    .menu-item{background:#fff;border-radius:6px;box-shadow:0 1px 3px rgba(0,0,0,.1);padding:.8rem;margin:.6rem 0}
    .menu-header{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:.5rem}
    .price{font-weight:700;margin-left:.5rem}
    .assigned{display:flex;flex-wrap:wrap;gap:.4rem;margin-top:.6rem}
    .assign-person{flex:1 1 48%;height:var(--btn-h);display:flex;align-items:center;justify-content:center;background:var(--btn-bg);color:#fff;border-radius:6px;position:relative;opacity:.6;border:2px solid transparent}
    .assign-person.selected{opacity:1;border-color:#000}
    .assign-person .qty{position:absolute;bottom:-6px;right:-6px;width:24px;height:24px;border-radius:50%;background:#000;color:#fff;display:flex;align-items:center;justify-content:center;font-size:.7rem}
    #actionBar{display:none;margin-top:1rem;gap:1rem;flex-wrap:wrap}
    #actionBar button{flex:1 1 48%}
    /* highlight Click to Order Food */
    #personModal .order-btn{background:var(--accent);font-weight:700}
    #personModal .order-btn:hover{background:#1565c0}
  </style>
</head>
<body>
  <h1>Anno 1800 – Essen bestellen / Place your Order</h1>
  <p class="description">Choose who you are ordering for — it can be multiple people.<br>Wähle, für wen du bestellst – es können mehrere Personen sein.</p>
  <div id="selectedPersons"></div>
  <button id="choosePersonBtn">Choose person(s) / Person(en) auswählen</button>
  <button id="chooseFoodBtn">Choose your food / Essen auswählen</button>
  <div id="menuContainer" style="display:none;margin-top:1rem"></div>
  <div id="actionBar">
    <button id="finishBtn" style="background:#008000">Finished – WhatsApp / Fertig – WhatsApp</button>
    <button id="copyBtn">Copy text / Text kopieren</button>
  </div>

  <!-- Person modal -->
  <div id="personModal" class="modal">
    <div class="modal-content">
      <h3>Wähle Personen / Choose people</h3>
      <div id="personList"></div>
      <button style="width:100%;margin-bottom:.8rem" onclick="addNewName()">Add New Name / Neuen Namen hinzufügen</button>
      <button class="order-btn" style="width:100%" onclick="closePersonModal()">Click to Order Food</button>
    </div>
  </div>

  <!-- Assignment modal -->
  <div id="assignModal" class="modal">
    <div class="modal-content">
      <h3 id="assignTitle"></h3>
      <div id="assignList" style="display:flex;flex-wrap:wrap;gap:var(--gap);margin:1rem 0"></div>
      <button style="width:100%" onclick="confirmAssignment()">OK</button>
    </div>
  </div>

  <script>
    /* ---------- DATA ---------- */
    const people=["Christa","Jochen","Sabine","Sven","Tom","Jan","Lena","Ben","Jojo","Hanna","Alex","Belle","Ellen","Vikas","Lisa","Mira"];
    // 69‑item Anno 1800 menu (kept shortened here for brevity)
    const menu=[{de:"Achatschnecken mit feinen Gemüsewürfeln in Kräuterbutter, dazu frisches Brot",en:"Achatschnecken ...",price:"8,00 €"},/* …66 more… */];

    /* ---------- STATE ---------- */
    const selected={},orders={};

    /* ---------- UTILS ---------- */
    const colourUsed=new Set();
    function distinctHue(){
      let hue;let tries=0;
      do{hue=Math.floor(Math.random()*360);tries++;}while([...colourUsed].some(h=>Math.abs(h-hue)<40)&&tries<50);
      colourUsed.add(hue);return `hsl(${hue},70%,50%)`;
    }

    /* ---------- ELEMENTS ---------- */
    const els={
      personModal:document.getElementById('personModal'),
      personList:document.getElementById('personList'),
      chooseFoodBtn:document.getElementById('chooseFoodBtn'),
      selectedPersons:document.getElementById('selectedPersons'),
      menuContainer:document.getElementById('menuContainer'),
      actionBar:document.getElementById('actionBar'),
      assignModal:document.getElementById('assignModal'),
      assignTitle:document.getElementById('assignTitle'),
      assignList:document.getElementById('assignList')
    };

    /* ---------- PERSON BUTTONS ---------- */
    function createPersonBtn(name){
      const btn=document.createElement('button');btn.className='person-btn';btn.textContent=name;
      btn.onclick=()=>{
        if(selected[name]){delete selected[name];btn.classList.remove('selected');btn.style.background='';colourUsed.delete(btn._hue);}else{
          const colour=distinctHue();btn._hue=parseInt(colour.match(/hsl\((\d+)/)[1]);selected[name]=colour;btn.classList.add('selected');btn.style.background=colour;}
      };
      els.personList.append(btn);
    }
    people.forEach(createPersonBtn);
    function addNewName(){const n=prompt('Enter new name')?.trim();if(n&&!people.includes(n)){people.push(n);createPersonBtn(n);}}

    /* ---------- RENDER SELECTED ---------- */
    function renderSelected(){
      els.selectedPersons.innerHTML='';Object.entries(selected).forEach(([n,c])=>{const chip=document.createElement('span');chip.className='person-chip';chip.textContent=n;chip.style.background=c;els.selectedPersons.append(chip);});
      els.chooseFoodBtn.style.display=Object.keys(selected).length?'block':'none';
    }

    /* ---------- MODAL CONTROLS ---------- */
    document.getElementById('choosePersonBtn').onclick=()=>els.personModal.classList.add('active');
    window.closePersonModal=()=>{els.personModal.classList.remove('active');renderSelected();};

    /* ---------- MENU ---------- */
    els.chooseFoodBtn.onclick=()=>{
      els.menuContainer.innerHTML='';menu.forEach((it,i)=>{const div=document.createElement('div');div.className='menu-item';div.innerHTML=`<div class='menu-header'><div><strong>${it.de}</strong><br><em>${it.en}</em> <span class='price'>${it.price}</span></div><button onclick='openAssign(${i})'>Select</button></div><div class='assigned' id='a${i}'></div>`;els.menuContainer.append(div);});
      els.menuContainer.style.display='block';els.actionBar.style.display='flex';
    };

    /* ---------- ASSIGN ---------- */
    window.openAssign=i=>{els.assignTitle.textContent=menu[i].de;els.assignList.innerHTML='';Object.entries(selected).forEach(([n,c])=>{let qty=(orders[n]||{})[i]||0;const d=document.createElement('div');d.className='assign-person';d.style.background=c;const update=()=>d.innerHTML=n+(qty?`<span class='qty'>${qty}</span>`:'');update();d.onclick=()=>{qty=(qty+1)%6;qty?d.classList.add('selected'):d.classList.remove('selected');update();orders[n]=orders[n]||{};qty?orders[n][i]=qty:delete orders[n][i];};if(qty)d.classList.add('selected');els.assignList.append(d);});els.assignModal.classList.add('active');};
    window.confirmAssignment=()=>{els.assignModal.classList.remove('active');menu.forEach((_,i)=>{const wrap=document.getElementById(`a${i}`);wrap.innerHTML='';Object.entries(selected).forEach(([n,c])=>{const q=(orders[n]||{})[i]||0;if(q){const chip=document.createElement('span');chip.className='person-chip';chip.textContent=`${n} (${q})`;chip.style.background=c;wrap.append(chip);}});});};

    /* ---------- EXPORT ---------- */
    function buildMsg(){let out='';Object.keys(orders).forEach(n=>{out+=n+':\n';Object.entries(orders[n]).forEach(([i,q])=>{const it=menu[i];out+=`- ${q}× ${it.de} (${it.en}) – ${it.price}\n`;});out+='\n';});return out.trim();}
    document.getElementById('finishBtn').onclick=()=>{const t=buildMsg();navigator.clipboard.writeText(t).catch(()=>{});location.href=(/iphone|ipad|android/i.test(navigator.userAgent)?'whatsapp://send?text=':'https://wa.me/?text=')+encodeURIComponent(t);};
    document.getElementById('copyBtn').onclick=()=>{const t=buildMsg();navigator.clipboard.writeText(t).then(()=>alert('Copied!')).catch(()=>alert(t));};
  </script>
</body>
</html>
